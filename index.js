!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var s=i();for(var e in s)("object"==typeof exports?exports:t)[e]=s[e]}}(this,(()=>(()=>{"use strict";var t={593:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this.listeners=new Set,this.register=this._register.bind(this)}_register(t){return this.listeners.add(t),{dispose:()=>{this.listeners.delete(t)}}}fire(t){for(const i of this.listeners)try{i(t)}catch(t){console.error(t)}}}},287:(t,i,s)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.LineDiscipline=void 0;const e=s(918),o=s(925),r=s(593);i.LineDiscipline=class{constructor(){this._onWriteToLower=new r.EventEmitter,this.onWriteToLower=this._onWriteToLower.register,this._onWriteToUpper=new r.EventEmitter,this.onWriteToUpper=this._onWriteToUpper.register,this._onSignalToUpper=new r.EventEmitter,this.onSignalToUpper=this._onSignalToUpper.register,this._onFlowActivated=new r.EventEmitter,this.onFlowActivated=this._onFlowActivated.register,this._onFlowDeactivated=new r.EventEmitter,this.onFlowDeactivated=this._onFlowDeactivated.register,this.T=o.defaultTermios,this.keyActions=new Array(256).fill("normal"),this.flowActivated=!0,this.column=0,this.baseColumn=0,this.vlnext=!1,this.echoprt=!1,this.toLowerBuf=[],this.toUpperBuf=[],this.termios=o.defaultTermios}activateFlow(){this.flowActivated=!0,this._onFlowActivated.fire()}deactivateFlow(){this.flowActivated=!1,this._onFlowDeactivated.fire()}get flow(){return this.flowActivated}get termios(){return this.T}set termios(t){this.T=t;const i=new Array(256).fill("normal");t.ICANON_P&&(i[t.EOF_V]="VEOF",i[t.EOL_V]="VEOL",i[t.EOL2_V]="VEOL",i[t.ERASE_V]="VERASE",i[t.KILL_V]="VKILL",t.IEXTEN_P&&(i[t.REPRINT_V]="VREPRINT",i[t.WERASE_V]="VWERASE")),t.IEXTEN_P&&(i[t.LNEXT_V]="VLNEXT"),t.IXON_P&&(i[t.START_V]="VSTART",i[t.STOP_V]="VSTOP"),t.ISIG_P&&(i[t.INTR_V]="VINTR",i[t.QUIT_V]="VQUIT",i[t.SUSP_V]="VSUSP"),i[0]="normal",this.keyActions=i,this.T.IXON_P||(this.activateFlow(),this.flushToLower())}clearToLower(){this.toLowerBuf.length=0}flushToLower(){0!=this.flowActivated&&(this._onWriteToLower.fire(this.toLowerBuf),this.clearToLower())}outputToLower(t){this.toLowerBuf.push(...t)}updateBaseColumn(){0==this.toUpperBuf.length&&(this.baseColumn=this.column)}clearToUpper(){this.toUpperBuf.length=0,this.updateBaseColumn()}flushToUpper(){this._onWriteToUpper.fire(this.toUpperBuf),this.clearToUpper()}outputToUpper(t){this.toUpperBuf.push(t)}outputToLowerWithPostprocess(t){if(this.T.OPOST_P)switch(t){case e.BS:this.column>0&&this.column--,this.outputToLower([e.BS]);break;case e.TAB:{const t=8-this.column%8;this.column+=t,this.outputToLower(this.T.TABDLY_XTABS_P?new Array(t).fill(e.SP):[e.TAB]);break}case e.NL:this.T.ONLCR_P?(this.baseColumn=this.column=0,this.outputToLower([e.CR,e.NL])):this.T.ONLRET_P?(this.column=0,this.outputToLower([e.NL])):(this.baseColumn=this.column,this.outputToLower([e.NL]));break;case e.CR:this.T.ONOCR_P&&0==this.column||(this.T.OCRNL_P?(this.T.ONLRET_P&&(this.baseColumn=this.column=0),this.outputToLower([e.NL])):(this.baseColumn=this.column=0,this.outputToLower([e.CR])));break;default:this.T.IUTF8_P&&(0,e.isUtf8ContinuationByte)(t)||this.column++,this.outputToLower(this.T.OLCUC_P?[(0,e.toupper)(t)]:[t])}else this.outputToLower([t])}echoToLower(t,i){"number"==typeof t&&(t=[t]);for(const s of t)this.T.ECHOCTL_P&&(0,e.iscntrl)(s)&&s!=e.TAB&&!i?(this.outputToLower([94,64^s]),this.column+=2):this.outputToLowerWithPostprocess(s)}inputFromLowerWithPreprocess(t){if(t==e.CR){if(this.T.IGNCR_P)return;this.T.ICRNL_P&&(t=e.NL)}else t==e.NL&&this.T.INLCR_P&&(t=e.CR);this.T.ICANON_P&&t==e.NL?((this.T.ECHO_P||this.T.ECHONL_P)&&(this.echoToLower(e.NL,!0),this.flushToLower()),this.outputToUpper(e.NL),this.flushToUpper()):this.T.ECHO_P?(this.finishECHOPRT(),this.updateBaseColumn(),t==e.NL?this.echoToLower(e.NL,!0):this.echoToLower(t),this.flushToLower(),this.outputToUpper(t)):this.outputToUpper(t)}erase(t){if(0==this.toUpperBuf.length)return;if("VKILL"==t){if(!this.T.ECHO_P)return void this.clearToUpper();if(!this.T.ECHOK_P||!this.T.ECHOKE_P||!this.T.ECHOE_P)return this.clearToUpper(),this.finishECHOPRT(),this.echoToLower(this.T.KILL_V),void(this.T.ECHOK_P&&this.echoToLower(e.NL,!0))}let i=!1;for(let s=this.toUpperBuf.length-1;s>=0;s--){const o=this.toUpperBuf[s];if(this.T.IUTF8_P&&(0,e.isUtf8ContinuationByte)(o))continue;if("VWERASE"==t)if((0,e.isalnum)(o)||95==o)i=!0;else if(i)break;const r=this.toUpperBuf.splice(s);if(this.T.ECHO_P)if(this.T.ECHOPRT_P)this.startECHOPRT(),this.echoToLower(r);else if("VERASE"!=t||this.T.ECHOE_P)if(o==e.TAB){let t=0,i=!1;for(let s=this.toUpperBuf.length-1;s>=0;s--){const o=this.toUpperBuf[s];if(o==e.TAB){i=!0;break}(0,e.iscntrl)(o)?this.T.ECHOCTL_P&&(t+=2):this.T.IUTF8_P&&(0,e.isUtf8ContinuationByte)(o)||t++}i||(t+=this.baseColumn),t=8-t%8,this.outputToLower(new Array(t).fill(e.BS)),this.column=Math.max(0,this.column-t)}else(0,e.iscntrl)(o)&&this.T.ECHOCTL_P&&this.echoToLower([e.BS,e.SP,e.BS],!0),(0,e.iscntrl)(o)&&!this.T.ECHOCTL_P||this.echoToLower([e.BS,e.SP,e.BS],!0);else this.echoToLower(this.T.ERASE_V);if("VERASE"==t)break}0==this.toUpperBuf.length&&(this.clearToUpper(),this.T.ECHO_P&&this.finishECHOPRT())}startECHOPRT(){this.echoprt||(this.echoToLower(92,!0),this.echoprt=!0)}finishECHOPRT(){this.echoprt&&(this.echoToLower(47,!0),this.echoprt=!1)}signal(t,i){this._onSignalToUpper.fire(t),this.T.NOFLSH_P||(this.clearToLower(),this.clearToUpper()),this.T.IXON_P&&this.activateFlow(),this.T.ECHO_P&&this.echoToLower(i),this.flushToLower()}checkStartFlow(){0==this.flowActivated&&this.T.IXON_P&&this.T.IXANY_P&&(this.activateFlow(),this.flushToLower())}nextLiteral(){this.vlnext=!0,this.T.ECHO_P&&(this.finishECHOPRT(),this.T.ECHOCTL_P&&(this.echoToLower([94,e.BS],!0),this.flushToLower()))}reprint(){this.finishECHOPRT(),this.echoToLower(this.T.REPRINT_V),this.echoToLower(e.NL,!0),this.echoToLower(this.toUpperBuf)}writeFromLower(t){const i="string"==typeof t?(0,e.stringToUtf8Bytes)(t):t;for(let t of i){this.T.ISTRIP_P&&(t&=127),this.T.IUCLC_P&&this.T.IEXTEN_P&&(t=(0,e.tolower)(t));const i=this.vlnext?"normal":this.keyActions[t];switch(this.vlnext=!1,i){case"normal":this.checkStartFlow(),this.inputFromLowerWithPreprocess(t);break;case"VERASE":case"VWERASE":case"VKILL":this.checkStartFlow(),this.erase(i),this.flushToLower();break;case"VEOF":this.checkStartFlow(),this.flushToUpper();break;case"VEOL":this.checkStartFlow(),this.T.ECHO_P&&(this.echoToLower(t),this.flushToLower()),this.outputToUpper(t),this.flushToUpper();break;case"VLNEXT":this.checkStartFlow(),this.nextLiteral();break;case"VREPRINT":this.checkStartFlow(),this.reprint(),this.flushToLower();break;case"VSTART":this.activateFlow(),this.flushToLower();break;case"VSTOP":this.deactivateFlow();break;case"VINTR":this.signal("SIGINT",t);break;case"VQUIT":this.signal("SIGQUIT",t);break;case"VSUSP":this.signal("SIGTSTP",t)}}this.T.ICANON_P||this.flushToUpper()}writeFromUpper(t){if(0==this.flowActivated)throw"Do not write anything during flowStatus is stopped";const i="string"==typeof t?(0,e.stringToUtf8Bytes)(t):t;for(const t of i)this.outputToLowerWithPostprocess(t);this.flushToLower()}}},836:(t,i,s)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.openpty=i.Slave=void 0;const e=s(593),o=s(287),r=s(925),h=s(918);class n{constructor(t,i){this.ldisc=t,this.slave=i,this.disposables=[],this._onWrite=new e.EventEmitter,this.onWrite=this._onWrite.register,this.fromLdiscToLowerBuffer=[],this.waitingForLower=!1;const s=()=>{if(this.fromLdiscToLowerBuffer.length>=1){this.waitingForLower=!0;const t=new Uint8Array(this.fromLdiscToLowerBuffer.splice(0,4096));this.fromLdiscToLowerBuffer.length<=4096&&this.notifyWritable(),this._onWrite.fire([t,s])}else this.waitingForLower=!1};this.ldisc.onWriteToLower((t=>{this.fromLdiscToLowerBuffer.push(...t),this.waitingForLower||s()}));const{notifyWritable:o,notifyResize:r}=i.initFromMaster();this.notifyWritable=o,this.notifyResize=r}activate(t){this.onWrite((([i,s])=>t.write(i,s)));const i=t=>this.ldisc.writeFromLower(t);this.disposables.push(t.onData(i),t.onBinary(i),t.onResize((({cols:t,rows:i})=>this.notifyResize(i,t))))}dispose(){this.disposables.forEach((t=>t.dispose())),this.disposables.length=0}}class l{constructor(t){this.ldisc=t,this._onReadable=new e.EventEmitter,this.onReadable=this._onReadable.register,this._onWritable=new e.EventEmitter,this.onWritable=this._onWritable.register,this._onSignal=new e.EventEmitter,this.onSignal=this._onSignal.register,this.fromLdiscToUpperBuffer=[],this.fromUpperToLdiscBuffer=[],this.winsize=[80,24],this.ldisc.onWriteToUpper((t=>{this.fromLdiscToUpperBuffer.push(...t),this._onReadable.fire()})),this.ldisc.onFlowActivated((()=>{this.fromUpperToLdiscBuffer.length>=1&&(this.ldisc.writeFromUpper(this.fromUpperToLdiscBuffer),this.fromUpperToLdiscBuffer.length=0)})),this.ldisc.onSignalToUpper((t=>{this._onSignal.fire(t)}))}initFromMaster(){return{notifyWritable:()=>this._onWritable.fire(),notifyResize:(t,i)=>{this.winsize=[i,t],this._onSignal.fire("SIGWINCH")}}}get readable(){return this.fromLdiscToUpperBuffer.length>=1}read(t){const i=void 0!==t?Math.min(this.fromLdiscToUpperBuffer.length,t):this.fromLdiscToUpperBuffer.length;return this.fromLdiscToUpperBuffer.splice(0,i)}get writable(){return this.fromUpperToLdiscBuffer.length<=4096}write(t){const i="string"==typeof t?(0,h.stringToUtf8Bytes)(t):t;this.fromUpperToLdiscBuffer=this.fromUpperToLdiscBuffer.concat(i),this.ldisc.flow&&(this.ldisc.writeFromUpper(this.fromUpperToLdiscBuffer),this.fromUpperToLdiscBuffer.length=0)}ioctl(t,i){switch(t){case"TCGETS":return this.ldisc.termios.clone();case"TCSETS":return void(this.ldisc.termios=r.Termios.fromConfig(i));case"TIOCGWINSZ":return this.winsize.slice()}}}i.Slave=l,i.openpty=()=>{const t=new o.LineDiscipline,i=new l(t);return{master:new n(t,i),slave:i}}},925:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.defaultTermios=i.Termios=void 0;class s{constructor(t,i,s,e,o){this.iflag=t,this.oflag=i,this.cflag=s,this.lflag=e,this.cc=o,this.ISTRIP_P=0!=(32&this.iflag),this.INLCR_P=0!=(64&this.iflag),this.IGNCR_P=0!=(128&this.iflag),this.ICRNL_P=0!=(256&this.iflag),this.IUCLC_P=0!=(512&this.iflag),this.IXON_P=0!=(1024&this.iflag),this.IXANY_P=0!=(2048&this.iflag),this.IUTF8_P=0!=(16384&this.iflag),this.OPOST_P=0!=(1&this.oflag),this.OLCUC_P=0!=(2&this.oflag),this.ONLCR_P=0!=(4&this.oflag),this.OCRNL_P=0!=(8&this.oflag),this.ONOCR_P=0!=(16&this.oflag),this.ONLRET_P=0!=(32&this.oflag),this.TABDLY_XTABS_P=6144==(6144&this.oflag),this.ISIG_P=0!=(1&this.lflag),this.ICANON_P=0!=(2&this.lflag),this.ECHO_P=0!=(8&this.lflag),this.ECHOE_P=0!=(16&this.lflag),this.ECHOK_P=0!=(32&this.lflag),this.ECHONL_P=0!=(64&this.lflag),this.NOFLSH_P=0!=(128&this.lflag),this.ECHOCTL_P=0!=(512&this.lflag),this.ECHOPRT_P=0!=(1024&this.lflag),this.ECHOKE_P=0!=(2048&this.lflag),this.IEXTEN_P=0!=(32768&this.lflag),this.INTR_V=this.cc[0],this.QUIT_V=this.cc[1],this.ERASE_V=this.cc[2],this.KILL_V=this.cc[3],this.EOF_V=this.cc[4],this.TIME_V=this.cc[5],this.MIN_V=this.cc[6],this.SWTCH_V=this.cc[7],this.START_V=this.cc[8],this.STOP_V=this.cc[9],this.SUSP_V=this.cc[10],this.EOL_V=this.cc[11],this.REPRINT_V=this.cc[12],this.DISCARD_V=this.cc[13],this.WERASE_V=this.cc[14],this.LNEXT_V=this.cc[15],this.EOL2_V=this.cc[16]}static fromConfig(t){return new s(t.iflag,t.oflag,t.cflag,t.lflag,t.cc)}clone(){return s.fromConfig(this)}}i.Termios=s,i.defaultTermios=new s(25856,5,191,35387,[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},918:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.stringToUtf8Bytes=i.toupper=i.tolower=i.isUtf8ContinuationByte=i.iscntrl=i.isalnum=i.SP=i.CR=i.NL=i.TAB=i.BS=void 0,i.BS=8,i.TAB=9,i.NL=10,i.CR=13,i.SP=32,i.isalnum=t=>48<=t&&t<=57||65<=t&&t<=90||95==t||97<=t&&t<=122,i.iscntrl=t=>0<=t&&t<=31&&9!=t||127==t,i.isUtf8ContinuationByte=t=>128==(192&t),i.tolower=t=>65<=t&&t<=90?t+32:t,i.toupper=t=>97<=t&&t<=122?t-32:t;const s=new TextEncoder;i.stringToUtf8Bytes=t=>Array.from(s.encode(t))}},i={};function s(e){var o=i[e];if(void 0!==o)return o.exports;var r=i[e]={exports:{}};return t[e](r,r.exports,s),r.exports}var e={};return(()=>{var t=e;Object.defineProperty(t,"__esModule",{value:!0}),t.openpty=void 0;var i=s(836);Object.defineProperty(t,"openpty",{enumerable:!0,get:function(){return i.openpty}})})(),e})()));
//# sourceMappingURL=index.js.map